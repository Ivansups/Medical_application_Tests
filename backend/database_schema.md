# Упрощенная схема базы данных - Система тестирования студентов

## Обзор
Упрощенная система тестирования студентов с 5 основными таблицами для управления пользователями, тестами, вопросами, попытками прохождения и ответами.

## Таблицы

### 1. `users` - Пользователи системы
```
┌─────────────────┬──────────────┬─────────────┬─────────────┐
│ Поле            │ Тип          │ Ограничения │ Описание    │
├─────────────────┼──────────────┼─────────────┼─────────────┤
│ id              │ UUID         │ PK          │ Уникальный ID│
│ email           │ VARCHAR(255) │ UNIQUE, NOT NULL │ Email пользователя │
│ hashed_password │ VARCHAR      │ NOT NULL    │ Хеш пароля  │
│ name            │ VARCHAR(255) │ NULL        │ Имя пользователя │
│ is_active       │ BOOLEAN      │ DEFAULT true│ Активен ли  │
│ role            │ VARCHAR(20)  │ DEFAULT 'student' │ Роль: student/admin │
│ created_at      │ TIMESTAMP    │ NOT NULL    │ Дата создания │
└─────────────────┴──────────────┴─────────────┴─────────────┘
```

### 2. `tests` - Тесты
```
┌──────────────┬──────────────┬─────────────┬─────────────┐
│ Поле         │ Тип          │ Ограничения │ Описание    │
├──────────────┼──────────────┼─────────────┼─────────────┤
│ id           │ UUID         │ PK          │ Уникальный ID│
│ title        │ VARCHAR(255) │ NOT NULL    │ Название теста │
│ description  │ VARCHAR(500) │ NULL        │ Описание теста │
│ duration     │ INTEGER      │ NOT NULL    │ Длительность в минутах │
│ is_active    │ BOOLEAN      │ DEFAULT true│ Активен ли тест │
│ created_at   │ TIMESTAMP    │ DEFAULT now │ Дата создания │
└──────────────┴──────────────┴─────────────┴─────────────┘
```

### 3. `questions` - Вопросы в тестах
```
┌─────────────────┬──────────────┬─────────────┬─────────────┐
│ Поле            │ Тип          │ Ограничения │ Описание    │
├─────────────────┼──────────────┼─────────────┼─────────────┤
│ id              │ UUID         │ PK          │ Уникальный ID│
│ test_id         │ UUID         │ FK(tests.id)│ Ссылка на тест │
│ question_text   │ TEXT         │ NOT NULL    │ Текст вопроса │
│ options         │ JSON         │ NULL        │ Варианты ответов │
│ correct_answers │ JSON         │ NULL        │ Правильные ответы │
│ question_type   │ VARCHAR(50)  │ DEFAULT 'multiple_choice' │ Тип вопроса │
│ points          │ INTEGER      │ DEFAULT 1   │ Баллы за вопрос │
│ order_index     │ INTEGER      │ DEFAULT 0   │ Порядок в тесте │
└─────────────────┴──────────────┴─────────────┴─────────────┘
```

### 4. `test_attempts` - Попытки прохождения тестов
```
┌──────────────┬──────────────┬─────────────┬─────────────┐
│ Поле         │ Тип          │ Ограничения │ Описание    │
├──────────────┼──────────────┼─────────────┼─────────────┤
│ id           │ UUID         │ PK          │ Уникальный ID│
│ user_id      │ UUID         │ FK(users.id)│ Ссылка на пользователя │
│ test_id      │ UUID         │ FK(tests.id)│ Ссылка на тест │
│ started_at   │ TIMESTAMP    │ NOT NULL    │ Время начала │
│ completed_at │ TIMESTAMP    │ NULL        │ Время завершения │
│ score        │ INTEGER      │ NULL        │ Набранные баллы │
│ max_score    │ INTEGER      │ NULL        │ Максимальные баллы │
│ status       │ VARCHAR(20)  │ DEFAULT 'in_progress' │ Статус: in_progress/completed/abandoned │
└──────────────┴──────────────┴─────────────┴─────────────┘
```

### 5. `user_answers` - Ответы пользователей на вопросы
```
┌──────────────┬──────────────┬─────────────┬─────────────┐
│ Поле         │ Тип          │ Ограничения │ Описание    │
├──────────────┼──────────────┼─────────────┼─────────────┤
│ id           │ UUID         │ PK          │ Уникальный ID│
│ attempt_id   │ UUID         │ FK(test_attempts.id) │ Ссылка на попытку │
│ question_id  │ UUID         │ FK(questions.id) │ Ссылка на вопрос │
│ selected_options │ JSON     │ NULL        │ Выбранные варианты │
│ text_answer  │ TEXT         │ NULL        │ Текстовый ответ │
│ is_correct   │ BOOLEAN      │ NULL        │ Правильность ответа │
│ points_earned│ INTEGER      │ DEFAULT 0   │ Полученные баллы │
│ answered_at  │ TIMESTAMP    │ NOT NULL    │ Время ответа │
└──────────────┴──────────────┴─────────────┴─────────────┘
```

## Связи между таблицами

```
users (1) ──── (N) test_attempts (1) ──── (N) user_answers
  │                                              │
  │                                              │
tests (1) ──── (N) questions (1) ────────────────┘
```

## Детализация связей

### One-to-Many (1:N)
- **users → test_attempts**: Один пользователь может иметь много попыток
- **tests → questions**: Один тест может содержать много вопросов
- **tests → test_attempts**: Один тест может иметь много попыток
- **test_attempts → user_answers**: Одна попытка может содержать много ответов
- **questions → user_answers**: Один вопрос может иметь много ответов

### Many-to-One (N:1)
- **test_attempts → users**: Много попыток принадлежат одному пользователю
- **test_attempts → tests**: Много попыток относятся к одному тесту
- **questions → tests**: Много вопросов принадлежат одному тесту
- **user_answers → test_attempts**: Много ответов принадлежат одной попытке
- **user_answers → questions**: Много ответов относятся к одному вопросу

## Индексы
- `users.email` - UNIQUE INDEX
- `questions.test_id` - INDEX
- `test_attempts.user_id` - INDEX
- `test_attempts.test_id` - INDEX
- `test_attempts.status` - INDEX
- `user_answers.attempt_id` - INDEX
- `user_answers.question_id` - INDEX

## Типы данных JSON
- **questions.options**: `["Вариант 1", "Вариант 2", "Вариант 3"]`
- **questions.correct_answers**: `[0, 2]` (индексы правильных ответов)
- **user_answers.selected_options**: `[1, 3]` (индексы выбранных вариантов)

## Роли пользователей
- **student**: Студент - может проходить тесты
- **admin**: Администратор - полные права на систему (создание тестов, управление пользователями)

## Статусы попыток
- **in_progress**: Тест в процессе прохождения
- **completed**: Тест завершен
- **abandoned**: Тест прерван

## Ключевые упрощения

### 1. Удалена таблица `test_results`
- Результаты вычисляются из `test_attempts` и `user_answers`
- Уменьшено количество таблиц с 6 до 5
- Упрощена структура данных

### 2. Упрощена структура `user_answers`
- Разделены поля `selected_options` и `text_answer` вместо общего `answer_data`
- Добавлено поле `points_earned` для отслеживания баллов
- Более понятная структура данных

### 3. Добавлено поле `status` в `test_attempts`
- Лучшее отслеживание состояния попытки
- Возможность фильтрации по статусу

### 4. Упрощены роли пользователей
- Убрана роль `teacher` (можно добавить позже при необходимости)
- Оставлены только `student` и `admin`

### 5. Добавлено поле `is_active` в `tests`
- Возможность деактивировать тесты без удаления
- Лучшее управление контентом

## Преимущества упрощенной схемы

1. **Меньше таблиц** - проще для понимания и поддержки
2. **Меньше дублирования** - данные не повторяются
3. **Лучшая производительность** - меньше JOIN операций
4. **Проще миграции** - меньше зависимостей между таблицами
5. **Более гибкая** - легче добавлять новые функции
